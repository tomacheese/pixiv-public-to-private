# CLAUDE.md

## 目的

このドキュメントは、Claude Code の作業方針とプロジェクト固有ルールを示します。

## 判断記録のルール

作業中の重要な判断については、以下の内容を記録してください：

- 判断内容の要約
- 検討した代替案
- 採用しなかった案とその理由
- 前提条件・仮定・不確実性
- 他エージェント（Gemini など）によるレビューの要否

## プロジェクト概要

- 目的: pixiv の公開ブックマークを自動的に非公開に変更する。
- 主な機能: イラストおよび小説の公開ブックマークを巡回し、非公開設定で再保存する。

## 重要ルール

- 会話言語: 日本語
- コメント言語: 日本語
- エラーメッセージ: 英語
- コミット規約: [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/)（`<description>` は日本語）
- 日本語と英数字の間には半角スペースを挿入する。

## 環境のルール

- ブランチ命名: [Conventional Branch](https://conventional-branch.github.io)（短縮形 `feat/`, `fix/` を使用）
- GitHub リポジトリ調査: 外部リポジトリの参照が必要な場合は、テンポラリディレクトリに clone して検索する。
- Renovate: Renovate が作成した PR に対して、追加コミットや更新を行わない。

## Git Worktree

Git Worktree を使用する場合は以下の構成とする：

- `.bare/`: bare リポジトリ
- `<branch>/`: 各ブランチの worktree

## コード改修時のルール

- エラーメッセージの先頭に絵文字がある場合は、プロジェクトのスタイルに合わせて適切な絵文字を付与する。
- TypeScript: `skipLibCheck` を有効にして型エラーを回避することは禁止。
- docstring: 公開・内部問わず、関数やインターフェースには日本語で JSDoc を記載する。

## 相談ルール

- Codex CLI: 実装のレビュー、局所的な設計相談、既存コードとの整合性確認。
- Gemini CLI: 外部仕様の調査、最新の技術動向や API 仕様の確認。
- 指摘への対応: レビュー指摘（信頼度 50 以上）には必ず対応し、無視しない。

## 開発コマンド

```bash
# インストール
pnpm install

# 実行
pnpm start

# Lint (ESLint, Prettier, tsc)
pnpm lint

# 自動修正
pnpm fix
```

## アーキテクチャと主要ファイル

- `src/main.ts`: アプリケーションのメインロジック。
- `@book000/pixivts`: pixiv API との通信を担当。

## 実装パターン

- `Logger.configure('name')` を使用してロガーを初期化する。
- `process.env` からの設定取得は `main` 関数または適切な初期化箇所で行う。

## テスト

- テストが未実装のため、重要なロジックの変更時には単体テストの導入を検討する。

## ドキュメント更新ルール

- `README.md`: 設定項目や使用方法に変更があった場合に更新。

## 作業チェックリスト

### 新規改修時

- [ ] プロジェクトの構造を十分に理解したか
- [ ] 適切なブランチ（最新の `master` または `main` ベース）で作業しているか
- [ ] 依存パッケージを最新の状態でインストールしたか

### コミット・プッシュ前

- [ ] コミットメッセージが Conventional Commits に従っているか
- [ ] 機密情報（トークンなど）が紛れ込んでいないか
- [ ] `pnpm lint` でエラーが発生しないか
- [ ] 動作確認を行い、意図した通りに動作するか

### PR 作成前

- [ ] ユーザーから PR 作成の許可を得ているか（または指示に含まれているか）
- [ ] 競合が発生する可能性がないか

### PR 作成後

- [ ] PR 本文に最新の変更内容が日本語で詳細に記載されているか
- [ ] CI (`gh pr checks`) がパスしているか
- [ ] Copilot / Codex のレビューに対応したか

## リポジトリ固有

- `data/token.json` の読み書きを行うため、ファイルシステムへのアクセス権限に注意する。
